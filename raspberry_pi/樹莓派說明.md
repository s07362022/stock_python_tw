# 樹莓派說明

本資料夾為「每日美股台股建議」專案的樹莓派專用版本。所有檔案已複製完成，可直接上傳至樹莓派使用。

---

## 一、檔案檢查結果

### ✅ 每日寄信核心（必備）

| 檔案 | 說明 |
|------|------|
| `daily_us_tw_email.py` | **主程式**：產生每日報告並寄送 |
| `dynamic_threshold.py` | 動態門檻：依 20 日波動率計算大跌/大漲閥值 |
| `strategy_stats.py` | 策略回測：7 檔標的（0050、0052、台達電、旺宏、聯電、廣達、鴻海）大跌/大漲/平盤買歷史統計 |
| `screen_top_stocks.py` | 熱門股篩選：50 檔熱門台股回測，取前 20 名建議 |

### ✅ 排程與腳本

| 檔案 | 說明 |
|------|------|
| `run_daily_email.sh` | 執行腳本：呼叫主程式寄信，支援 `--boot` 開機模式 |
| `setup_raspberry_schedule.sh` | 排程安裝：開機 + 每日 8:00 自動執行 |

### ✅ 其他專案檔案（可選）

| 檔案 | 說明 |
|------|------|
| `main.py` | LSTM 台股預測（需 torch，樹莓派可能較慢） |
| `data_fetcher.py` | 資料抓取模組 |
| `indicators.py` | 技術指標計算 |
| `model.py` | LSTM 模型 |
| `config.py` | 全域設定 |
| `project2_us_tw_signal.py` | 美股連動分析（NVDA、AAPL、TSM、QQQ） |
| `project3_us_close_vs_tw_open.py` | 美股收盤 vs 台股開盤連動比較 |
| `us_tw_signal.py` | 美股台股連動訊號輔助模組 |
| `strategy_buy_tomorrow_probability.py` | 策略買入明日機率 |
| `backtest_dynamic.py` | 動態門檻回測（產出圖表） |
| `backtest_us_tw_tsmc.py` | 固定門檻回測 |
| `experiment_vol_window.py` | 波動率視窗實驗 |

### ✅ 設定檔

| 檔案 | 說明 |
|------|------|
| `requirements.txt` | Python 依賴：yfinance, pandas, numpy, matplotlib |
| `README.md` | 英文版說明 |
| `樹莓派說明.md` | 本說明檔 |

---

## 二、快速安裝（5 步驟）

### 1. 上傳至樹莓派

將整個 `raspberry_pi` 資料夾複製到樹莓派，例如：

```bash
scp -r raspberry_pi pi@樹莓派IP:/home/pi/202602/
```

或使用 SCP、SFTP、WinSCP 等工具上傳。

### 2. 安裝 Python 依賴

```bash
cd /home/pi/202602
pip3 install -r requirements.txt
```

> 若只要執行每日寄信，上述套件即可；`main.py`（LSTM）需額外安裝 `torch`、`scikit-learn`。

### 3. 安裝排程

```bash
chmod +x setup_raspberry_schedule.sh
./setup_raspberry_schedule.sh
```

### 4. 設定時區為台灣

```bash
sudo timedatectl set-timezone Asia/Taipei
```

### 5. 驗證排程

```bash
crontab -l
```

應看到兩行：
- `@reboot ... run_daily_email.sh --boot`
- `0 8 * * * ... run_daily_email.sh`

---

## 三、排程說明

| 時機 | 行為 |
|------|------|
| **開機時** | 等待 90 秒（網路就緒）後執行一次 |
| **每天早上 8:00** | 台灣時間固定執行並寄信 |

### Log 檔位置

- 開機執行：`stock/cron_boot.log`
- 每日 8 點：`stock/cron_daily.log`

---

## 四、手動執行

```bash
# 直接執行並寄出
./run_daily_email.sh

# 模擬開機（含 90 秒等待）
./run_daily_email.sh --boot

# 僅預覽不寄出
python3 daily_us_tw_email.py --preview

# 直接寄出（不詢問）
python3 daily_us_tw_email.py --send
```

---

## 五、產出檔案

| 路徑 | 說明 |
|------|------|
| `stock/{YYYY-MM-DD}_建議.txt` | 當日完整建議文字 |
| `stock/{YYYY-MM-DD}_篩選結果.txt` | 熱門 50 檔篩選結果（若單獨執行 `screen_top_stocks.py`） |

---

## 六、注意事項

1. **信箱與密碼**：寄件者、收件者、Gmail 應用程式密碼已寫入 `daily_us_tw_email.py`，若更換密碼請於程式中更新 `GMAIL_APP_PASSWORD`。
2. **網路**：樹莓派需有網路連線（yfinance 需下載美股／台股資料）。
3. **樹莓派效能**：每日寄信流程輕量，樹莓派可順暢執行；`main.py`（LSTM）需 GPU 或較長訓練時間，可視需求選擇是否使用。
4. **移除排程**：執行 `crontab -e`，刪除與 `run_daily_email.sh` 相關的兩行即可。

---

## 七、依賴關係圖

```
daily_us_tw_email.py（主程式）
├── dynamic_threshold.py
├── strategy_stats.py
│   └── dynamic_threshold.py
└── screen_top_stocks.py
    └── dynamic_threshold.py
```

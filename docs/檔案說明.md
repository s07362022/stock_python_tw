# 檔案說明

本文件說明專案中各檔案的用途與關係。

---

## 一、每日寄信（每日執行）

### `daily_us_tw_email.py` ⭐ 每日主程式

**用途**：每日美股統整與台股操作建議，產生報告並寄送。

**流程**：
1. 抓取 QQQ 資料，計算 20 日波動率
2. 依波動率計算動態閥值（大跌/大漲判定）
3. 取得美股昨日收盤表現
4. 依第五、六項回測綜合結果產出建議（3 個月優先 + 交集）
5. 平盤時依 0050/0052 歷史表現給建議
6. 儲存內容至 `stock/{日期}_建議.txt`
7. 可選擇寄出或預覽

**參數**：
- `--preview` / `-p`：僅預覽，不寄出
- `--send`：直接寄出（不詢問）

**相依**：`dynamic_threshold`、`strategy_stats`

---

### `schedule_daily_email.bat`

**用途**：一鍵執行每日寄信。

**內容**：執行 `python daily_us_tw_email.py --send`，適合排程或手動雙擊。

---

## 二、核心模組（被 daily_us_tw_email 使用）

### `strategy_stats.py`

**用途**：策略歷史統計，產出大跌買/大漲買/平盤買的勝率與均報酬。

**主要函式**：
- `fetch_and_backtest()`：最近 3 個月回測
- `fetch_and_backtest_6m()`：過去半年回測
- `get_flat_etf_recommendation()`：0050/0052 平盤建議
- `get_combined_recommendation()`：3 個月優先 + 交集建議
- `get_strategy_table()`：產出策略表文字
- `generate_backtest_chart_6m()`：產出半年回測圖表（可選）

**標的**：0050、0052、台達電、旺宏、聯電、廣達、鴻海

---

### `dynamic_threshold.py`

**用途**：動態門檻計算，依 20 日波動率調整大跌/大漲判定門檻。

**主要函式**：
- `compute_volatility_regime()`：計算滾動波動率
- `get_dynamic_threshold()`：依波動率回傳 (crash_threshold, surge_threshold)
- `apply_dynamic_threshold()`：對美股資料加上每日門檻

**參數**：波動低 → 門檻 0.7%；波動高 → 門檻 1.8%

---

## 三、專案一：LSTM 台股預測

### `main.py`

**用途**：LSTM 預測台股走勢，驗證並輸出 `result_prediction.png`。

**流程**：下載資料 → 技術指標 → LSTM 訓練 → 預測 → 繪圖

---

### `data_fetcher.py`

**用途**：透過 yfinance 抓取台股/美股資料。

---

### `indicators.py`

**用途**：計算技術指標（RSI、MACD、布林通道、ATR、SMA、EMA、OBV 等）。

---

### `model.py`

**用途**：LSTM 模型建立、序列產生、訓練、預測。

---

### `config.py`

**用途**：全域設定，含台股/美股代碼、日期範圍等。

---

## 四、專案二、三：美股連動

### `project2_us_tw_signal.py`

**用途**：美股連動分析，計算台股可能上漲機率。  
抓取 NVDA、AAPL、TSM、QQQ 等，輸出建議。

---

### `project3_us_close_vs_tw_open.py`

**用途**：美股收盤 vs 台股開盤連動比較。  
以昨晚美股收盤對應今日台股開盤表現。

---

### `us_tw_signal.py`

**用途**：美股台股連動訊號相關功能（輔助模組）。

---

### `strategy_buy_tomorrow_probability.py`

**用途**：策略買入明日機率相關計算。

---

## 五、回測腳本

### `backtest_dynamic.py`

**用途**：動態門檻回測。  
美股大跌/大漲後隔天買台股，依 20 日波動率動態門檻，產出 `backtest_dynamic_result.png`。

**標的**：台達電、旺宏、聯電、廣達、鴻海

---

### `backtest_us_tw_tsmc.py`

**用途**：固定門檻回測。  
使用固定門檻（-1%、+1%）做同樣策略回測，產出 `backtest_result.png`。

---

## 六、實驗與其他

### `experiment_vol_window.py`

**用途**：波動率視窗相關實驗。

---

### `email_content.txt`

**用途**：可能為信件內容草稿或暫存檔。

---

## 七、輸出檔案

| 檔案 | 說明 |
|------|------|
| `stock/{日期}_建議.txt` | 每日信件文字內容 |
| `stock/{日期}_回測圖表.png` | 半年回測圖表（若啟用） |
| `result_prediction.png` | LSTM 預測結果圖 |
| `backtest_dynamic_result.png` | 動態門檻回測圖 |
| `backtest_result.png` | 固定門檻回測圖 |

---

## 八、設定檔

### `requirements.txt`

**用途**：Python 依賴套件清單。

**主要套件**：yfinance, pandas, numpy, scikit-learn, torch, matplotlib
